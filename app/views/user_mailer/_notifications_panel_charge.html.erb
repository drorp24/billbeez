  <tr class="bill_background">
    <td bgcolor="#FDE9C9">
    	<% if notification.supplier %>
	    	<% if logo = notification .supplier.logo %>
	    		<%= image_tag logo, class: 'sup_logo' %>
	    	<% else %>	
	    		<%= notification.supplier.name %>
			<% end %>
		<% end %>
	</td>
    <td><%= l notification.bill.issue_date, format: :no_year if notification.bill.issue_date %></td>
    <td class="amount"><%= number_to_currency notification.bill.amount %></td>
	<td><%= number_to_currency notification.prev_bill_amt %></td>
	<td><%= number_to_currency notification.charges.sum(:amount) %></td>
	  <% if @control %>	
	  	<td class="control">
		  <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
		              customer_newsletter_bill_path(@customer, @newsletter, notification.bill, section: params[:section]),
		              :method => :delete,
		              :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
		              :class => 'btn btn-mini btn-danger' %>
	  	</td>
	  	<td class="control">
	  		<%= link_to "Edit", edit_customer_newsletter_bill_path(@customer, @newsletter, notification.bill, section: params[:section]), class: 'btn btn-mini' %>
  		</td>
  		<td class="control">
  			<%= link_to "Add Line", new_customer_newsletter_notification_line_path(@customer, @newsletter, notification, section: params[:section]), class: 'btn btn-mini' %>
		</td>
		<td class="leftmost">
  			<%= link_to "Add Charge", new_customer_newsletter_notification_charge_path(@customer, @newsletter, notification, section: params[:section]), class: 'btn btn-mini' %>
		</td>
	  <% end %>
  </tr>

  <% notification.charges.order(created_at: :desc).each do |charge| %>
  	<tr>
	  	<td><%= charge.service.name %></td>
	  	<td>
	  		<% if charge.status and charge.exception? %>
	  			<%= image_tag 'question-32.png' %>
  			<% elsif charge.status and charge.ok? %>
  				<%= image_tag 'check-32.png' %>
			<% end %>
	  	</td>
	  	<td><%= number_to_currency charge.amount if charge.amount %></td>
	  	<td><%= charge.comment.name %></td>
	  	<td><%= number_to_currency charge.amount if charge.amount %></td>	  	
	  	<% if @control %>
	  		<td>
			  <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
	          customer_newsletter_notification_charge_path(@customer, @newsletter, notification, charge, section: params[:section]),
	          :method => :delete,
	          :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
	          :class => 'btn btn-mini btn-danger' %>
	  		</td>
	  		<td>
	  			<%= link_to "Edit", edit_customer_newsletter_notification_charge_path(@customer, @newsletter, notification, charge, section: params[:section]), class: 'btn btn-mini' %>	  			
	  		</td>
	  		<td></td>
		<% end %>
  	</tr>
  <% end %>

  <% notification.lines.order(created_at: :desc).each do |line| %>
  	<tr>
	  	<td><%= line.part1 %></td>
	  	<td><%= line.part2 %></td>
	  	<td><%= line.part3 %></td>
	  	<td><%= line.part4 %></td>
	  	<td><%= line.part5 %></td>
	  	<% if @control %>
	  		<td>
			  <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
	          customer_newsletter_notification_line_path(@customer, @newsletter, notification, line, section: params[:section]),
	          :method => :delete,
	          :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
	          :class => 'btn btn-mini btn-danger' %>
	  		</td>
	  		<td>
	  			<%= link_to "Edit", edit_customer_newsletter_notification_line_path(@customer, @newsletter, notification, line, section: params[:section]), class: 'btn btn-mini' %>	  			
	  		</td>
		<% end %>
  	</tr>
  <% end %>
