<%= simple_form_for @newsletter, :html => { :class => 'form-horizontal newsletter_form' } do |f| %>
  <% name = params[:customer_id] ? Customer.find(params[:customer_id]).first_name + ' ' + Customer.find(params[:customer_id]).last_name : ' ' %>
  <%= f.input :customer_id, as: :string, disabled: true, input_html: { value: name, title: params[:customer_id] } %>
  <%= f.association :version, collection: Version.approved_and_matches_customer_locale(params[:customer_id]).order(id: :desc), value_method: :id, label_method: :id, include_blank: false %>
  <%= f.input :id, as: :string, label: "Newsletter" %>
  	<% @newsletter.attributes.each do |name, value| %>
  		<% next if ['customer_id', 'version_id','sent_at', 'id', 'created_at', 'updated_at'].include? name %>
  		<%= f.input name, as: :string %>
  	<% end %>
  <div class="form-actions">
    <%= f.button :submit, :class => 'btn-primary' %>
    <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                newsletters_path, :class => 'btn' %>
  </div>
<% end %>
<script>
	
$(document).ready(function() {
	
	align_val(<%= Customer.find(params[:customer_id]).locale_id %>)

	function refresh_sample() {
		var version_id = 	$('#newsletter_version_id').val()
		var newsletter_id = $('#newsletter_id').val()
		$.ajax({
	  		url: "<%= user_mailer_weekly_url %>",
	  		data: "version_id=" + version_id + "&newsletter_id=" + newsletter_id,
	  		success: function(result) {
	  			$('#sample').html(result);
	  	}});		
	}
	
	refresh_sample();

	$('.newsletter_form input').blur(function() {
		var field = 	$(this).attr('name').split('[')[1].split(']')[0]
		var value = 	$(this).val()
		$.ajax({
	  		type: 'PUT',
	  		url: "<%= newsletter_path(@newsletter)  %>",
	  		data: field + '=' + value,
	  		success: refresh_sample()
	  	});
	})
	
})	
	
</script>
